<%- include('base') %>
<%- include('_reviewCard') %>

<% layout('base') %>

<!-- Head section -->
<% block('head') { %>
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.umd.min.js"></script>
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.3/maptiler-sdk.css" rel="stylesheet">
<% } %>

<% function overviewBox(label, text, icon) { %>
  <div class="overview-box__detail">
    <svg class="overview-box__icon">
      <use xlink:href="/img/icons.svg#icon-<%= icon %>"></use>
    </svg>
    <span class="overview-box__label"><%= label %></span>
    <span class="overview-box__text"><%= text %></span>
  </div>
<% } %>

<main class="main">
  <!-- Header Section -->
  <section class="section-header">
    <div class="header__hero">
      <div class="header__hero-overlay">&nbsp;</div>
      <img class="header__hero-img" src="/img/tours/<%= tour.imageCover %>" alt="<%= tour.name %>">
    </div>

    <div class="heading-box">
      <h1 class="heading-primary">
        <span><%= tour.name %> tour</span>
      </h1>
      <div class="heading-box__group">
        <div class="heading-box__detail">
          <svg class="heading-box__icon">
            <use xlink:href="/img/icons.svg#icon-clock"></use>
          </svg>
          <span class="heading-box__text"><%= tour.duration %> days</span>
        </div>
        <div class="heading-box__detail">
          <svg class="heading-box__icon">
            <use xlink:href="/img/icons.svg#icon-map-pin"></use>
          </svg>
          <span class="heading-box__text"><%= tour.startLocation.description %></span>
        </div>
      </div>
    </div>
  </section>

  <!-- Overview Section -->
  <section class="section-description">
    <div class="overview-box">
      <div>
        <div class="overview-box__group">
          <h2 class="heading-secondary ma-bt-lg">Quick facts</h2>

          <% let date = new Date(tour.startDates[0]).toLocaleString('en-us', { month: 'long', year: 'numeric' }); %>
          <%= overviewBox('Next date', date, 'calendar') %>
          <%= overviewBox('Difficulty', tour.difficulty, 'trending-up') %>
          <%= overviewBox('Participants', tour.maxGroupSize + ' people', 'user') %>
          <%= overviewBox('Rating', tour.ratingsAverage + ' / 5', 'star') %>

        </div>

        <div class="overview-box__group">
          <h2 class="heading-secondary ma-bt-lg">Your tour guides</h2>

          <% tour.guides.forEach(function(guide) { %>
            <div class="overview-box__detail">
              <img class="overview-box__img" src="/img/users/<%= guide.photo %>" alt="<%= guide.name %>">
              <% if (guide.role === 'lead-guide') { %>
                <span class="overview-box__label">Lead Guide</span>
              <% } %>
              <% if (guide.role === 'guide') { %>
                <span class="overview-box__label">Tour Guide</span>
              <% } %>
              <span class="overview-box__text"><%= guide.name %></span>
            </div>
          <% }); %>
        </div>
      </div>

      <div class="description-box">
        <h2 class="heading-secondary ma-bt-lg">About <%= tour.name %> tour</h2>

        <% tour.description.split('\n').forEach(function(para) { %>
          <p class="description__text"><%= para %></p>
        <% }); %>
      </div>
    </div>
  </section>

  <!-- Pictures Section -->
  <section class="section-pictures">
    <% tour.images.forEach(function(image, i) { %>
      <div class="picture-box">
        <img class="picture-box__img picture-box__img--<%= i + 1 %>" src="/img/tours/<%= image %>" alt="<%= i + 1 %>">
      </div>
    <% }); %>
  </section>

  <!-- Map Section -->
  <section class="section-map">
    <div id="map" data-locations='<%- JSON.stringify(tour.locations) %>'></div>
  </section>

  <!-- Reviews Section -->
  <section class="section-reviews">
    <div class="reviews">
      <% tour.reviews.forEach(function(review) { %>
        <%- reviewCard(review) %>
      <% }); %>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="section-cta">
    <div class="cta">
      <div class="cta__img cta__img--logo">
        <img src="/img/logo-white.png" alt="Natours logo">
      </div>
      <img class="cta__img cta__img--1" src="/img/tours/<%= tour.images[1] %>" alt="Tour Picture">
      <img class="cta__img cta__img--2" src="/img/tours/<%= tour.images[2] %>" alt="Tour Picture">
      <div class="cta__content">
        <h2 class="heading-secondary">What are you waiting for?</h2>
        <p class="cta__text"><%= tour.duration %> days. 1 adventure. Infinite memories. Make it yours today!</p>
        <% if (user) { %>
          <button class="btn btn--green span-all-rows" id="book-tour" data-tour-id="<%= tour.id %>">Book tour now!</button>
        <% } else { %>
          <a class="btn btn--green span-all-rows" href="/login">Log In to book Tour!</a>
        <% } %>
      </div>
    </div>
  </section>
</main>
